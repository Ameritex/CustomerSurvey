@model UnsubscribeEmailViewModel
@{
    ViewData["Title"] = "Manage Email Preference";
    
}

<div class="mx-0 mx-sm-auto">
    <div class="card">
        <div class="card-body">
            <div class="text-center">
                <i class="far fa-file-alt fa-4x mb-3 text-primary"></i>
                <p>
                    <h1>Manage Email Preference</h1>

                </p>
            </div>
            <hr />
            <form id="emailSettingForm" class="px-4" action="">
                    <div class="questionSeparator">
                    <p>
                        <h4>Frequency</h4>

                    </p>
                        @*<p questionId="@question.Id" orderNo="@question.OrderNo"><strong>@question.Question</strong></p>*@
                        <div class="form-check mb-2">
                            @*<input class="form-check-input" type="radio" id="ef_onceADay" name="emailFrequency" />*@
                            <div>
                            @Html.RadioButtonFor(m => m.IsOnceADay, "true", new { @checked = "checked", @class = "form-check-input" })
                        
                            <label class="form-check-label" for="IsOnceADay">
                                Once a day
                            </label>
                        </div>
                            <div>
                            @Html.RadioButtonFor(m => m.IsOnceADay, "false", new { @checked = "checked", @class = "form-check-input", @id="AsTriggered" })
                            <label class="form-check-label" for="AsTriggered">
                                        As Triggered
                                    </label>
                            </div>
                        </div>
                    </div>
                     <div class="questionSeparator">                                
                    <input class="form-check-input" type="checkbox" id="isUnsubscribed" @((Model.IsUnsubscribed ?? false) ? "checked" : "") />
                    <label class="form-check-label" for="isUnsubscribed">
                        Unsubscribe
                    </label>
                    </div>
            </form>
            <div>
                <span id="message"></span>
            </div>
        </div>
        <div class="card-footer text-end">
            <button type="button" onclick="$('#emailSettingForm').submit();" class="btn btn-primary">Submit</button>
        </div>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
    </div>
</div>
<script type="text/javascript">
    $(function() {
        $('#emailSettingForm').submit(function () {
            const isUnsubscribed = $("#isUnsubscribed").is(":checked");
            const isOnceADay = $("[name=IsOnceADay]:checked").val();
            const email = window.location.pathname.replace(/.*\//, '');

            const data = {
                isUnsubscribed,
                isOnceADay,
                email
            }

            var jqxhr = $.post('/api/emailsetup/save', data, function(response){
                $('#message').html("Data is saved successfully!")
            });
                //.done(function (data) {
                //    var loc = jqxhr.getResponseHeader('Location');
                //    var a = $('<a/>', { href: loc, text: loc });
                //    $('#message').html(a);
                //})
                //.fail(function () {
                //    $('#message').html("Error posting the update.");
                //});

            return false;
        });
    });
</script>